<!DOCTYPE html>
<html lang="en">
<html>
<!-- This is the main page of the dashboard, it shows the real-time location of the robot on the map -->
<!--Jorge Askur was here--> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static',filename='images/favicon.ico') }}">
    <script>
        function updateResult() {
            fetch('/api/result')
            .then(response => response.json())
            .then(result => {
                // console.log(result);
                document.getElementById('result').textContent = result.poseX + ', ' + result.poseY;
                document.getElementById('Puzzlebot').style.left = String(((result.poseX*-1 / 3.5) * 640) + 80) + 'px';
                document.getElementById('Puzzlebot').style.top = String(480 -((result.poseY*-1 / 3.5) * 480) + 15) + 'px';
                console.log(result.orientationZ);
                document.getElementById('Puzzlebot').style.transform = 'rotate(' + String((-result.orientationZ*57.3)-90) + 'deg)';
                // if (result.poseX < -0.1 || result.poseX > 5 || result.poseY < -0.1 || result.poseY > 5) {
                //     document.getElementById('Puzzlebot').style.display = 'none';
                // } else {
                //     document.getElementById('Puzzlebot').style.display = 'block';
                // }
            });

        
        }
        setInterval(updateResult, 200);
    </script>

<script>
    function updateImage() {
        fetch('api/image')
        .then(response => response.text())
        .then(result_img => {
            const container = document.getElementById("Mapa")
            container.src = result_img
        });
    }
    setInterval(updateImage, 200)
</script>
    
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><img id="logo" src="{{ url_for('static',filename='images/logo.png') }}"alt="Logo"></li>
            </ul>
        </nav>
        <div id="nav-title">
            <h1>Dashboard</h1>
        </div>
    </header>

    <div class="dashboard">
        <h1> Real-Time Location</h1>
        <div class="map">
            <img id="Mapa"> </img>
            <img id="Puzzlebot" src="{{ url_for('static',filename='images/Puzzlebot.png') }}" alt="Placeholder Image">
        </div>
        <h6> Position (x, y) <p id="result"> </p>
        </h6>
    </div>
    
    <footer>
        <div class="footer">
            <p>2024 - Team 1</p>
        </div>
    </footer>
</body>
</html>